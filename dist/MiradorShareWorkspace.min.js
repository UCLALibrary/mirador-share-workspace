var MiradorShareWorkspace={locales:{en:{translation:{saveWorkspace:"Save Workspace",saveWorkspaceTooltip:"Save this workspace to your desktop",saveWorkspaceWarning:"Please do not give the filename an extension. It will be in JSON format, and a .json extension is automatically appended to the filename.",saveAs:"Save As",loadWorkspace:"Load Workspace",loadWorkspaceTooltip:"Restore a previously downloaded workspace from a file on your desktop",newWorkspace:"New Workspace",newWorkspaceWarning:"Only one workspace may be saved to this web browser's internal storage at a time. You can clear that workspace here. Note that you may still save as many workspaces as you like to your workstation using the \"Save Workspace\" function, which can be loaded as needed (doing so will overwrite the workspace that is saved to this browser's internal storage).",newWorkspaceClear:"Clear Workspace",newWorkspaceConfirm:"Confirm",newWorkspaceCancel:"Cancel"}}},template:Mirador.Handlebars.compile(["<li>",'<a href="javascript:;" class="save-workspace mainmenu-button" title="{{t "saveWorkspaceTooltip"}}">','<span class="fa fa-download fa-lg fa-fw"></span> {{t "saveWorkspace"}}',"</a>","</li>","<li>",'<a href="javascript:;" class="load-workspace mainmenu-button" title="{{t "loadWorkspaceTooltip"}}">','<span class="fa fa-upload fa-lg fa-fw"></span> {{t "loadWorkspace"}}',"</a>","</li>"].join("")),init:function(){var e=this;i18next.on("initialized",function(){for(var a in e.locales){var t="translation";i18next.addResourceBundle(a,t,e.locales[a][t],!0,!0)}}),function(a){var t=a.MainMenu.prototype.bindEvents;a.MainMenu.prototype.bindEvents=function(){var a=this;t.apply(this,arguments),this.element.find(".mirador-main-menu").prepend(e.template()),this.element.find(".save-workspace").on("click",function(){a.eventEmitter.publish("toggleSaveWorkspacePanel"),a.element.find(".sync-window-groups").removeClass("active"),jQuery(this).hasClass("active")?jQuery(this).removeClass("active"):jQuery(this).addClass("active")}),this.element.find(".load-workspace").on("click",function(){a.eventEmitter.publish("toggleLoadWorkspacePanel"),a.element.find(".sync-window-groups").removeClass("active"),jQuery(this).hasClass("active")?jQuery(this).removeClass("active"):jQuery(this).addClass("active")})}}(Mirador),function(e){var a=e.Viewer,t=e.Viewer.prototype,o=e.Viewer.prototype.setupViewer,s=e.Viewer.prototype.listenForActions;e.Viewer.prototype.setupViewer=function(){o.apply(this,arguments),this.mainMenu&&(this.saveWorkspacePanel=new e.SaveWorkspacePanel({appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter}),this.loadWorkspacePanel=new e.LoadWorkspacePanel({appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter}))},e.Viewer.prototype.listenForActions=function(){var e=this;s.apply(this,arguments),this.eventEmitter.subscribe("toggleSaveWorkspacePanel",function(a){e.toggleSaveWorkspacePanel()}),this.eventEmitter.subscribe("toggleLoadWorkspacePanel",function(a){e.toggleLoadWorkspacePanel()})},e.Viewer.prototype.toggleSaveWorkspacePanel=function(){this.toggleOverlay("saveWorkspacePanelVisible")},e.Viewer.prototype.toggleLoadWorkspacePanel=function(){this.toggleOverlay("loadWorkspacePanelVisible")},e.Viewer=function(){return new a(jQuery.extend(!0,Array.prototype.slice.call(arguments)[0],{overlayStates:{saveWorkspacePanelVisible:!1,loadWorkspacePanelVisible:!1}}))},e.Viewer.prototype=t}(Mirador)}};$(document).ready(function(){MiradorShareWorkspace.init()});
!function(e){e.LoadWorkspacePanel=function(e){jQuery.extend(!0,this,{element:null,appendTo:null},e),this.init()},e.LoadWorkspacePanel.prototype={init:function(){this.element=jQuery(this.template()).appendTo(this.appendTo),this.bindEvents(),this.listenForActions()},listenForActions:function(){var e=this;e.eventEmitter.subscribe("loadWorkspacePanelVisible.set",function(n,o){if(o)return e.show(),jQuery("#new-workspace").show(),void jQuery("#confirm-new-workspace").hide();e.hide()})},bindEvents:function(){var e=this;e.element.find("#load-workspace-file").on("change",function(e){var n,o=e.target.files[0],t=new FileReader;t.onload=function(e){n="saved-session",localStorage.setItem(n,e.target.result),window.location.assign(window.location.origin+window.location.pathname+"#"+n),window.location.reload()},t.readAsText(o)}),e.element.find('button[name="new-workspace"]').on("click",function(e){jQuery("#new-workspace").hide(),jQuery("#confirm-new-workspace").show()}),e.element.find('button[name="confirm-new-workspace"]').on("click",function(e){window.location.assign(window.location.origin+window.location.pathname)}),e.element.find('button[name="cancel-new-workspace"]').on("click",function(e){jQuery("#new-workspace").show(),jQuery("#confirm-new-workspace").hide()})},hide:function(){jQuery(this.element).hide({effect:"slide",direction:"up",duration:300,easing:"swing"})},show:function(){jQuery(this.element).show({effect:"slide",direction:"up",duration:300,easing:"swing"})},template:e.Handlebars.compile(['<div id="load-workspace-panel">','<h3>{{t "loadWorkspace"}}</h3>',"<span>",'<input id="load-workspace-file" type="file"></input>',"</span>",'<h3>{{t "newWorkspace"}}</h3>','<p>{{t "newWorkspaceWarning"}}</p>','<span id="new-workspace">','<button name="new-workspace" type="button">{{t "newWorkspaceClear"}}</button>',"</span>",'<span id="confirm-new-workspace">','<button name="confirm-new-workspace" type="button">{{t "newWorkspaceConfirm"}}</button>','<button name="cancel-new-workspace" type="button">{{t "newWorkspaceCancel"}}</button>',"</span>","</div>"].join(""))}}(Mirador);
!function(e){e.SaveWorkspacePanel=function(e){jQuery.extend(!0,this,{state:null,element:null,appendTo:null,eventEmitter:null},e),this.init()},e.SaveWorkspacePanel.prototype={init:function(){this.element=jQuery(this.template()).appendTo(this.appendTo),this.bindEvents(),this.listenForActions()},listenForActions:function(){var e=this;e.eventEmitter.subscribe("saveWorkspacePanelVisible.set",function(i,n){n?e.show():e.hide()})},bindEvents:function(){var e=this;e.element.find(".mirador-icon-save-workspace-file").off("click").on("click",function(i){var n=jQuery("#save-workspace-file").val();if(n.length>0){var t=JSON.stringify(e.state.cleanup(e.state.get("currentConfig")));download(t,n+"_mirador_workspace.json","text/json"),jQuery("#save-workspace-file").val("")}else alert("Please choose a name with non-zero length.")})},hide:function(){jQuery(this.element).hide({effect:"slide",direction:"up",duration:300,easing:"swing"})},show:function(){jQuery(this.element).show({effect:"slide",direction:"up",duration:300,easing:"swing"})},template:e.Handlebars.compile(['<div id="save-workspace-panel">','<h3>{{t "saveWorkspace"}}</h3>','<span>{{t "saveAs"}}: ','<input id="save-workspace-file" type="text">','<a href="javascript:;" class="mirador-btn mirador-icon-save-workspace-file">','<i class="fa fa-download fa-lg"></i>',"</a>","</span>",'<p>{{t "saveWorkspaceWarning"}}</p>',"</div>"].join(""))}}(Mirador);
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.download=t()}(this,function(){return function e(t,n,o){function a(e){var t=e.split(/[:;,]/);e=t[1];var n=(t=("base64"==t[2]?atob:decodeURIComponent)(t.pop())).length,o=0,a=new Uint8Array(n);for(o;o<n;++o)a[o]=t.charCodeAt(o);return new s([a],{type:e})}function r(e,t){if("download"in l)return l.href=e,l.setAttribute("download",p),l.className="download-js-link",l.innerHTML="downloading...",l.style.display="none",document.body.appendChild(l),setTimeout(function(){l.click(),document.body.removeChild(l),!0===t&&setTimeout(function(){i.URL.revokeObjectURL(l.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,"application/octet-stream")),!window.open(e)&&confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var n=document.createElement("iframe");document.body.appendChild(n),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,"application/octet-stream")),n.src=e,setTimeout(function(){document.body.removeChild(n)},333)}var i=window,d=o||"application/octet-stream",c=!n&&!o&&t,l=document.createElement("a");o=function(e){return String(e)};var s=i.Blob||i.MozBlob||i.WebKitBlob||o,p=n||"download",s=s.call?s.bind(i):Blob;if("true"===String(this)&&(t=[t,d],d=t[0],t=t[1]),c&&2048>c.length&&(p=c.split("/").pop().split("?")[0],l.href=c,-1!==l.href.indexOf(c))){var u=new XMLHttpRequest;return u.open("GET",c,!0),u.responseType="blob",u.onload=function(t){e(t.target.response,p,"application/octet-stream")},setTimeout(function(){u.send()},0),u}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(t)){if(!(2096103.424<t.length&&s!==o))return navigator.msSaveBlob?navigator.msSaveBlob(a(t),p):r(t);t=a(t),d=t.type||"application/octet-stream"}else if(/([\x80-\xff])/.test(t)){n=0;var f=(c=new Uint8Array(t.length)).length;for(n;n<f;++n)c[n]=t.charCodeAt(n);t=new s([c],{type:d})}if(t=t instanceof s?t:new s([t],{type:d}),navigator.msSaveBlob)return navigator.msSaveBlob(t,p);if(i.URL)r(i.URL.createObjectURL(t),!0);else{if("string"==typeof t||t.constructor===o)try{return r("data:"+d+";base64,"+i.btoa(t))}catch(e){return r("data:"+d+","+encodeURIComponent(t))}(d=new FileReader).onload=function(e){r(this.result)},d.readAsDataURL(t)}return!0}});