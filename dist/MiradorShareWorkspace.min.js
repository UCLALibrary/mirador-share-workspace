var MiradorShareWorkspace={locales:{en:{translation:{downloadWorkspace:"Download Workspace",downloadWorkspaceTooltip:"Sace this workspace to your desktop",downloadWorkspaceWarning:"Please do not give the filename an extension. It will be in JSON format, and a .json extension is automatically appended to the filename.",saveAs:"Save As",uploadWorkspace:"Upload Workspace",uploadWorkspaceTooltip:"Restore a previously downloaded workspace"}}},template:Mirador.Handlebars.compile(["<li>",'<a href="javascript:;" class="download-workspace mainmenu-button" title="{{t "downloadWorkspaceTooltip"}}">','<span class="fa fa-download fa-lg fa-fw"></span> {{t "downloadWorkspace"}}',"</a>","</li>","<li>",'<a href="javascript:;" class="upload-workspace mainmenu-button" title="{{t "uploadWorkspaceTooltip"}}">','<span class="fa fa-upload fa-lg fa-fw"></span> {{t "uploadWorkspace"}}',"</a>","</li>"].join("")),init:function(){var e=this;i18next.on("initialized",function(){for(var a in e.locales){var o="translation";i18next.addResourceBundle(a,o,e.locales[a][o],!0,!0)}}),function(a){var o=a.MainMenu.prototype.bindEvents;a.MainMenu.prototype.bindEvents=function(){var a=this;o.apply(this,arguments),this.element.find(".mirador-main-menu").prepend(e.template()),this.element.find(".download-workspace").on("click",function(){a.eventEmitter.publish("toggleDownloadWorkspacePanel"),a.element.find(".sync-window-groups").removeClass("active"),jQuery(this).hasClass("active")?jQuery(this).removeClass("active"):jQuery(this).addClass("active")}),this.element.find(".upload-workspace").on("click",function(){a.eventEmitter.publish("toggleUploadWorkspacePanel"),a.element.find(".sync-window-groups").removeClass("active"),jQuery(this).hasClass("active")?jQuery(this).removeClass("active"):jQuery(this).addClass("active")})}}(Mirador),function(e){var a=e.Viewer,o=e.Viewer.prototype,t=e.Viewer.prototype.setupViewer,i=e.Viewer.prototype.listenForActions;e.Viewer.prototype.setupViewer=function(){t.apply(this,arguments),this.mainMenu&&(this.downloadWorkspacePanel=new e.DownloadWorkspacePanel({appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter}),this.uploadWorkspacePanel=new e.UploadWorkspacePanel({appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter}))},e.Viewer.prototype.listenForActions=function(){var e=this;i.apply(this,arguments),this.eventEmitter.subscribe("toggleDownloadWorkspacePanel",function(a){e.toggleDownloadWorkspacePanel()}),this.eventEmitter.subscribe("toggleUploadWorkspacePanel",function(a){e.toggleUploadWorkspacePanel()})},e.Viewer.prototype.toggleDownloadWorkspacePanel=function(){this.toggleOverlay("downloadWorkspacePanelVisible")},e.Viewer.prototype.toggleUploadWorkspacePanel=function(){this.toggleOverlay("uploadWorkspacePanelVisible")},e.Viewer=function(){return new a(jQuery.extend(!0,Array.prototype.slice.call(arguments)[0],{overlayStates:{downloadWorkspacePanelVisible:!1,uploadWorkspacePanelVisible:!1}}))},e.Viewer.prototype=o}(Mirador)}};$(document).ready(function(){MiradorShareWorkspace.init()});
!function(e){e.DownloadWorkspacePanel=function(e){jQuery.extend(!0,this,{state:null,element:null,appendTo:null,eventEmitter:null},e),this.init()},e.DownloadWorkspacePanel.prototype={init:function(){this.element=jQuery(this.template()).appendTo(this.appendTo),this.bindEvents(),this.listenForActions()},listenForActions:function(){var e=this;e.eventEmitter.subscribe("downloadWorkspacePanelVisible.set",function(n,o){o?e.show():e.hide()})},bindEvents:function(){var e=this;e.element.find(".mirador-icon-download-workspace-file").off("click").on("click",function(n){var o,t=jQuery("#download-workspace-file").val();t.length>0?((o=document.createElement("a")).href="data:text/json;charset=utf8,"+encodeURIComponent(JSON.stringify(e.state.cleanup(e.state.get("currentConfig")))),o.download=t+".json",document.body.appendChild(o),o.click(),document.body.removeChild(o),jQuery("#download-workspace-file").val("")):alert("Please choose a name with non-zero length.")})},hide:function(){jQuery(this.element).hide({effect:"slide",direction:"up",duration:300,easing:"swing"})},show:function(){jQuery(this.element).show({effect:"slide",direction:"up",duration:300,easing:"swing"})},template:e.Handlebars.compile(['<div id="download-workspace-panel">','<h3>{{t "downloadWorkspace"}}</h3>','<span>{{t "saveAs"}}: ','<input id="download-workspace-file" type="text">','<a href="javascript:;" class="mirador-btn mirador-icon-download-workspace-file">','<i class="fa fa-download fa-lg"></i>',"</a>","</span>",'<p>{{t "downloadWorkspaceWarning"}}</p>',"</div>"].join(""))}}(Mirador);
!function(e){e.UploadWorkspacePanel=function(e){jQuery.extend(!0,this,{element:null,appendTo:null},e),this.init()},e.UploadWorkspacePanel.prototype={init:function(){this.element=jQuery(this.template()).appendTo(this.appendTo),this.bindEvents(),this.listenForActions()},listenForActions:function(){var e=this;e.eventEmitter.subscribe("uploadWorkspacePanelVisible.set",function(n,i){i?e.show():e.hide()})},bindEvents:function(){this.element.find("#upload-workspace-file").on("change",function(n){var i,t=n.target.files[0],o=new FileReader;o.onload=function(n){i=e.genUUID(),localStorage.setItem(i,n.target.result),window.location.assign(window.location.origin+window.location.pathname+"#"+i),window.location.reload()},o.readAsText(t)})},hide:function(){jQuery(this.element).hide({effect:"slide",direction:"up",duration:300,easing:"swing"})},show:function(){jQuery(this.element).show({effect:"slide",direction:"up",duration:300,easing:"swing"})},template:e.Handlebars.compile(['<div id="upload-workspace-panel">','<h3>{{t "uploadWorkspace"}}</h3>',"<span>",'<input id="upload-workspace-file" type="file"></input>',"</span>","</div>"].join(""))}}(Mirador);